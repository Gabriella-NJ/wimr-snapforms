<div id=D__ID>
    <section id=form_container__ID>
        <div id=preview__ID>
        </div>
        <div style='border-top:1px solid black;padding-top:20px'>
            <button type="button" id=send__ID class="btn btn-secondary">Send Email</button> <button type="button" id=cancel__ID class="btn btn-secondary">Cancel</button>
        </div>
    </section>
    <script>
    	function F__ID(){
			//-------------------------------------
            var m=$vm.module_list['__MODULE__'];
            if(m.prefix==undefined) m.prefix="";
            var p=m.prefix;
            $('#D__ID').on('load',function(){
                var url=$vm.module_list[p+"template-sleep-registration"].url;
                $.get(url+'?_='+$vm.ver[0],function(txt){
                    var data=m.input.data;
                    txt=txt.replace('[FIRST_NAME]',data.first_name);                    
                    txt=txt.replace('[APPOINTMENT_WITH]',data.appointment_with);                    
                    txt=txt.replace('[APPOINTMENT_LINK]',data.appointment_link);                    
                    txt=txt.replace('[APPOINTMENT_LINK]',data.appointment_link);                    
                    $('#preview__ID').html(txt);
                },'text');
            })
			//-------------------------------------
            $('#send__ID').on('click',function(){
                var h=$('#preview__ID').html();
                var data=m.input.data;
                var d={
                    body:btoa(unescape(encodeURIComponent(h))),
                    email:data.email,
                    subject:data.template
                }
                $vm.request({cmd:'flow',flowid:"General Email",data:d},function(res){
                    if(res.status=="ok") alert("The email has been sent.");
					else if(res.status=="np") alert("No permissions.");
                })
                history.go(-1);
            })
            $('#cancel__ID').on('click',function(){
                history.go(-1);
            })
		}
    </script>
    <style>
        #form_container__ID{
            max-width:700px;
        }
        #form_container__ID{
            background-color:#fff;
            margin-top:20px;
            margin-left: auto;
            margin-right: auto;
            font-family: Verdana,sans-serif;
            font-size: 15px;
            line-height: 1.5;
            padding:0px 30px 30px 30px;
        }
		/*Vm Include:__CURRENT_PATH__form.css*/
    </style>
</div>
